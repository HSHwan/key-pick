{% extends 'booking/base.html' %}

{% block title %}ì§€ì  ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block content %}
<div class="branch-manager-dashboard">
    <h1>ğŸ“Š ì§€ì  ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
    <p><strong>{{ user.name }}</strong>ë‹˜ ({{ user.get_role_display }})</p>
    
    <hr>
    
    <!-- ì´ë²ˆ ë‹¬ ë§¤ì¶œ í†µê³„ -->
    <div class="sales-section">
        <h2>ğŸ’° ì´ë²ˆ ë‹¬ ë§¤ì¶œ í†µê³„ ({{ month_start|date:"Y.m.d" }} ~ {{ month_end|date:"Y.m.d" }})</h2>
        
        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead style="background: #333; color: white;">
                <tr>
                    <th style="padding: 12px; text-align: left;">ì§€ì ëª…</th>
                    <th style="padding: 12px; text-align: right;">ì´ ë§¤ì¶œ</th>
                    <th style="padding: 12px; text-align: center;">ì˜ˆì•½ ê±´ìˆ˜</th>
                    <th style="padding: 12px; text-align: right;">í‰ê·  ê°ë‹¨ê°€</th>
                </tr>
            </thead>
            <tbody>
                {% for item in branch_sales %}
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 12px;"><strong>{{ item.branch.branch_name }}</strong></td>
                        <td style="padding: 12px; text-align: right; font-weight: bold; color: #28a745;">
                            {{ item.total_sales|floatformat:0 }}ì›
                        </td>
                        <td style="padding: 12px; text-align: center;">{{ item.reservation_count }}ê±´</td>
                        <td style="padding: 12px; text-align: right;">
                            {% if item.reservation_count > 0 %}
                                {{ item.total_sales|divisibleby:item.reservation_count|floatformat:0 }}ì›
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <hr style="margin-top: 40px;">
    
    <!-- ì´ë²ˆ ì£¼ ìŠ¤ì¼€ì¤„ -->
    <div class="schedule-section">
        <h2>ğŸ“… ì´ë²ˆ ì£¼ ìŠ¤ì¼€ì¤„ ({{ week_start|date:"Y.m.d" }} ~ {{ week_end|date:"Y.m.d" }})</h2>
        
        {% if schedules %}
            <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead style="background: #007bff; color: white;">
                    <tr>
                        <th style="padding: 10px; text-align: left;">ë‚ ì§œ</th>
                        <th style="padding: 10px; text-align: left;">ì§ì›</th>
                        <th style="padding: 10px; text-align: left;">ì§€ì </th>
                        <th style="padding: 10px; text-align: center;">ê·¼ë¬´ ì‹œê°„</th>
                        <th style="padding: 10px; text-align: left;">ë°°ì • í…Œë§ˆ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for schedule in schedules %}
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px;">{{ schedule.work_date|date:"Y.m.d (D)" }}</td>
                            <td style="padding: 10px;"><strong>{{ schedule.member.name }}</strong></td>
                            <td style="padding: 10px;">{{ schedule.branch.branch_name }}</td>
                            <td style="padding: 10px; text-align: center;">
                                {{ schedule.start_time|time:"H:i" }} ~ {{ schedule.end_time|time:"H:i" }}
                            </td>
                            <td style="padding: 10px;">
                                {% if schedule.assigned_theme %}
                                    {{ schedule.assigned_theme.name }}
                                {% else %}
                                    <span style="color: #888;">ë¯¸ë°°ì •</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="margin-top: 20px; color: #888;">ì´ë²ˆ ì£¼ ìŠ¤ì¼€ì¤„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>
    
    <hr style="margin-top: 40px;">
    
    <!-- í…Œë§ˆë³„ ì˜ˆì•½ í˜„í™© (TOP 10) -->
    <div class="theme-stats-section">
        <h2>ğŸ† í…Œë§ˆë³„ ì˜ˆì•½ í˜„í™© TOP 10 (ì´ë²ˆ ë‹¬)</h2>
        
        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead style="background: #28a745; color: white;">
                <tr>
                    <th style="padding: 10px; text-align: center;">ìˆœìœ„</th>
                    <th style="padding: 10px; text-align: left;">í…Œë§ˆëª…</th>
                    <th style="padding: 10px; text-align: left;">ì§€ì </th>
                    <th style="padding: 10px; text-align: center;">ì™„ë£Œ ì˜ˆì•½ ìˆ˜</th>
                    <th style="padding: 10px; text-align: center;">í‰ê·  ë³„ì </th>
                </tr>
            </thead>
            <tbody>
                {% for theme in theme_stats %}
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 10px; text-align: center; font-weight: bold;">{{ forloop.counter }}</td>
                        <td style="padding: 10px;"><strong>{{ theme.name }}</strong></td>
                        <td style="padding: 10px;">{{ theme.branch.branch_name }}</td>
                        <td style="padding: 10px; text-align: center; font-size: 1.1em; color: #007bff;">
                            {{ theme.reservation_count }}ê±´
                        </td>
                        <td style="padding: 10px; text-align: center;">
                            {% if theme.avg_rating %}
                                <span style="color: #ffc107;">â­ {{ theme.avg_rating|floatformat:1 }}</span>
                            {% else %}
                                <span style="color: #888;">-</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
</div>
{% endblock %}